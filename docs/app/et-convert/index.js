"use strict";let file_txt=null,previewer=null,datalist=[];function decode(n){file_txt.value="",previewer.style.display="none",datalist=[];let a=`ponto , E , N , Z , descri\xE7\xE3o
`,e=0;const i=n.byteLength,l=new TextDecoder("UTF-8");for(;e<i;){if(n[e]==255){e++;continue}if(n[e]==126){e++;const d=l.decode(n.subarray(e,e+10)).trim();e+=10;const o=new DataView(n.buffer,e,8).getFloat64(0,!0);e+=8;const c=new DataView(n.buffer,e,8).getFloat64(0,!0);e+=8;const f=new DataView(n.buffer,e,8).getFloat64(0,!0);if(e+=8,n[e]!=109){alert("Erro: era esperado a descri\xE7\xE3o do ponto; posi\xE7\xE3o: "+e);return}e++;const s=l.decode(n.subarray(e,e+10)).trim();e+=10,a+=`${d} , ${c} , ${o} , ${f} , ${s}
`,datalist.push({nome:d,E:c,N:o,desc:s})}else{alert("Erro: era esperado outro ponto; posi\xE7\xE3o: "+e);return}}file_txt.value=a,file_txt.style.display="block"}const colors=["#279c03","#bf490d","#600dbf","#bf0d60","#10ccad","#c4c11a"];window.addEventListener("load",()=>{file_txt=document.getElementById("et_txt"),previewer=document.getElementById("et_preview");const n=document.getElementById("et_file"),a=document.getElementById("et_save_txt"),e=document.getElementById("et_view_preview");a.addEventListener("click",()=>{if(file_txt.value==""){alert("vazio");return}var i=document.createElement("a");if(i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(file_txt.value)),i.setAttribute("download","pontos.txt"),document.createEvent){var l=document.createEvent("MouseEvents");l.initEvent("click",!0,!0),i.dispatchEvent(l)}else i.click()}),n.addEventListener("change",()=>{if(n.files&&n.files.length>0){var i=new FileReader;i.onload=function(){var l=this.result;decode(new Uint8Array(l))},i.readAsArrayBuffer(n.files[0])}}),e.addEventListener("click",()=>{file_txt.style.display="none",previewer.style.display="block";const i=previewer.clientWidth,l=previewer.clientHeight,d=i>l?l:i;previewer.width=i,previewer.height=l;const o=previewer.getContext("2d");o.fillStyle="black",o.fillRect(0,0,i,l),o.font="bold 11px monospace";let c=1/0,f=-1/0,s=1/0,p=-1/0,u=[];datalist.forEach(t=>{t.E<c&&(c=t.E),t.E>f&&(f=t.E),t.N<s&&(s=t.N),t.N>p&&(p=t.N),u.find(r=>r==t.desc)==null&&u.push(t.desc)});let y=f-c,m=p-c;y==0&&(y=1),m==0&&(m=1),datalist.forEach(t=>{const r=((t.E-c)/y*.8+.1)*d,E=((1-(t.N-s)/y)*.8+.1)*d,v=u.findIndex(w=>w==t.desc),h=colors[v%colors.length];o.fillStyle=h,v==0?(o.strokeStyle=h,o.strokeRect(r-2,E-2,5,5),o.fillText(t.nome,r,E)):o.fillRect(r,E,3,3)}),u.forEach((t,r)=>{o.fillStyle=colors[r%colors.length],o.fillText(t,2,13+r*11)})})});
